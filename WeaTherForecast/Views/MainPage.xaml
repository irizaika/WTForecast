<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui" 
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:skia="clr-namespace:SkiaSharp.Views.Maui.Controls;assembly=SkiaSharp.Views.Maui.Controls" 
             xmlns:mc="clr-namespace:Microcharts.Maui;assembly=Microcharts.Maui"
             x:Class="WTForecast.Views.MainPage" xmlns:pageModels="clr-namespace:WTForecast.ViewModels" BackgroundColor="#111">
    <Grid>

            <!-- Background Effects -->
            <BoxView Opacity="1" InputTransparent="True">
                <BoxView.Background>
                    <RadialGradientBrush Center="0.5,0.75" Radius="0.8">
                        <GradientStop Color="#555555" Offset="0.0" />
                        <GradientStop Color="#000000" Offset="1.0" />
                    </RadialGradientBrush>
                </BoxView.Background>
            </BoxView>
            <!-- Main Content -->

        <RefreshView IsRefreshing="{Binding IsRefreshing}" Command="{Binding ReloadWeatherCommand}"> <!-- refresh on swipe down-->
            <ScrollView>
                <VerticalStackLayout Padding="5" Spacing="5" >
                    <!-- Title -->
                    <Label Text="WTForecast &#176;" FontSize="34" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center" Margin="0"/>
                    <!-- Current Weather Card -->
                    <Frame Padding="0" CornerRadius="30" BackgroundColor="#11FFFFFF" HasShadow="True" Margin="0">
                        <VerticalStackLayout Spacing="0" HorizontalOptions="Center" >
                            <Image x:Name="WeatherIcon" Source="{Binding IconPath}" IsVisible="{Binding IconVisible}" HeightRequest="80" WidthRequest="80" />
                            <Label x:Name="TemperatureLabel" Text="{Binding TemperatureText}" FontSize="46" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center" />
                            <Label x:Name="ConditionLabel" Text="{Binding ConditionText}" FontSize="22" TextColor="#E0E0E0" HorizontalTextAlignment="Center" />
                            <!-- Message/Joke -->
                            <!--<Label x:Name="MessageLabel" FontSize="18" FontAttributes="Italic" TextColor="#FFD700" HorizontalTextAlignment="Center" />-->
                            <HorizontalStackLayout HorizontalOptions="Center" Spacing="8">
                                <Label x:Name="WindLabel" Text="{Binding WindText}" FontSize="18" TextColor="#DDDDDD" VerticalOptions="Center" HorizontalTextAlignment="Center" />
                                <Label x:Name="WindArrow" Text="↑" Rotation="{Binding WindRotation}" IsVisible="{Binding WindRotationVisible}"  TextColor="#DDDDDD" FontSize="32" VerticalOptions="Center"/>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </Frame>
                    <!-- Todays Weather Card -->
                    <Frame Padding="0" CornerRadius="30" BackgroundColor="#11FFFFFF" HasShadow="True" Margin="0">
                        <VerticalStackLayout Padding="0" Margin="0">
                            <mc:ChartView x:Name="WeatherChart" Chart="{Binding HourlyTemperatureChart}" PaintSurface="OnCanvasViewPaintSurface" HeightRequest="250" IsVisible="True" VerticalOptions="FillAndExpand" Margin="0" HorizontalOptions="FillAndExpand"/>
                            <mc:ChartView x:Name="RainChart" Chart="{Binding HourlyRainChart}" PaintSurface="OnRainCanvasViewPaintSurface" HeightRequest="50" IsVisible="True" VerticalOptions="FillAndExpand" Margin="0" HorizontalOptions="FillAndExpand"/>
                        </VerticalStackLayout>
                    </Frame>
                    <!-- Daily Weather Card -->
                    <Frame Padding="0" CornerRadius="30" BackgroundColor="#11FFFFFF" HasShadow="True" Margin="0">
                        <VerticalStackLayout Padding="0" Margin="0">
                            <mc:ChartView x:Name="DailyMinMaxChart" PaintSurface="OnMinMaxDailyCanvasViewPaint"  Chart="{Binding DailyMinMaxChart}" HeightRequest="200" VerticalOptions="FillAndExpand" Margin="0" HorizontalOptions="FillAndExpand" />
                            <mc:ChartView x:Name="DailyRainChart" PaintSurface="OnDailyRainCanvasViewPaintSurface" Chart="{Binding DailyRainChart}" HeightRequest="150" VerticalOptions="FillAndExpand" Margin="0" HorizontalOptions="FillAndExpand" />
                        </VerticalStackLayout>
                    </Frame>
                </VerticalStackLayout>
            </ScrollView>
        </RefreshView>
        
        <!-- Loading overlay -->
        <Grid BackgroundColor="#80000000" IsVisible="{Binding IsLoading}">
            <ActivityIndicator 
            IsRunning="{Binding IsLoading}"
            Color="White"
            WidthRequest="60"
            HeightRequest="60"
            VerticalOptions="Center"
            HorizontalOptions="Center"/>
        </Grid>

    </Grid>
</ContentPage>
    